<html>
  <head>
    <title>Three.js test</title>
    <style>canvas { width: 100%; height: 100% }</style>
  </head>
  <body>
    <script src="three.min.js"></script>
    <script src="STLLoader.js"></script>
    <script>
      var scene, camera, cameraTarget, renderer, cube;


      function addShadowedLight( x, y, z, color, intensity ) {
        var directionalLight = new THREE.DirectionalLight( color, intensity );
        directionalLight.position.set( x, y, z )
        scene.add( directionalLight );
        directionalLight.castShadow = true;
        // directionalLight.shadowCameraVisible = true;
        var d = 1;
        directionalLight.shadowCameraLeft = -d;
        directionalLight.shadowCameraRight = d;
        directionalLight.shadowCameraTop = d;
        directionalLight.shadowCameraBottom = -d;
        directionalLight.shadowCameraNear = 1;
        directionalLight.shadowCameraFar = 4;
        directionalLight.shadowMapWidth = 1024;
        directionalLight.shadowMapHeight = 1024;
        directionalLight.shadowBias = -0.005;
        directionalLight.shadowDarkness = 0.15;
      }

      function init() {
        //camera
        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
        cameraTarget = new THREE.Vector3( 0, 1, 0 );
        camera.position.x = 2;
        camera.position.y = 3;
        camera.position.z = -5;
        camera.lookAt( cameraTarget );

        renderer = new THREE.WebGLRenderer( { antialias: true, alpha: false } );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.gammaInput = true;
        renderer.gammaOutput = true;
        renderer.physicallyBasedShading = true;
        renderer.shadowMapEnabled = true;
        renderer.shadowMapCullFace = THREE.CullFaceBack;
        document.body.appendChild( renderer.domElement );

        scene = new THREE.Scene();

        //ground
        var plane = new THREE.Mesh( new THREE.PlaneGeometry( 40, 40 ),
                                    new THREE.MeshPhongMaterial( { ambient: 0x999999, color: 0x999999, specular: 0x101010 } ) );
        plane.rotation.x = -Math.PI/2;
        //plane.position.x = 0;
        //plane.position.y = 0;
        //plane.position.z = 0;
        plane.receiveShadow = true;
        scene.add( plane );

        //lights
        scene.add( new THREE.AmbientLight( 0x777777 ) );
        addShadowedLight( 5, 5, 5, 0xffffff, 1.35 );
        addShadowedLight( 0.5, 1, -1, 0xffaa00, 1 );

        //cube
        var geometry = new THREE.CubeGeometry(1,1,1);
        var material = new THREE.MeshPhongMaterial( { ambient: 0x000055, color: 0x0000AA, specular: 0x000011, shininess: 200 } );
        //var material = new THREE.MeshBasicMaterial( { color: 0x888888 } );
        cube = new THREE.Mesh( geometry, material );
        cube.position.y = 1;
        cube.castShadow = true;
        cube.receiveShadow = true;
        scene.add( cube );
      }

      function render() {
        requestAnimationFrame(render);
        cube.rotation.x += 0.1;
        cube.rotation.y += 0.1;
        renderer.render(scene, camera);
      }


      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
      }

      init();
      render();
    </script>
  </body>
</html>
